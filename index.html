<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Opiniones de Vuelo ü™Ç</title>
<style>
body { font-family: Arial, sans-serif; background-color: #f0f2f5; margin:0; padding:20px; }
h1 { text-align: center; color: #333; }
.tabs { display: flex; justify-content: center; margin-bottom: 20px; flex-wrap: wrap; gap:5px; }
.tab { padding: 10px 20px; cursor: pointer; border-radius: 8px; background-color: #ddd; transition:0.3s; }
.tab.active { background-color: #4CAF50; color: white; }
.container { max-width: 800px; margin: auto; }
.zona { background-color: white; padding: 15px; margin-bottom: 15px; border-radius: 12px; box-shadow: 0 3px 8px rgba(0,0,0,0.1); }
.opinion { margin-left: 15px; margin-bottom: 10px; padding:8px; border-radius:8px; }
.opinion.vuelo { background-color: #e6f9e6; } 
.opinion.no-vuelo { background-color: #ffe6e6; }
.stars span { font-size: 22px; cursor: pointer; display:inline-block; margin-right:2px;}
.stars .selected { color: gold; }
.stars .unselected { color: #ccc; }
.btn { padding: 4px 8px; margin-left: 5px; border-radius: 5px; border: none; cursor: pointer; font-size:12px; }
.btn-edit { background-color:#2196F3; color:white; }
.btn-delete { background-color:#f44336; color:white; }
input, select { margin-right: 5px; padding: 5px; border-radius: 5px; border: 1px solid #ccc; }
.form-row { margin-bottom: 10px; display:flex; flex-wrap:wrap; gap:5px; }
@media(max-width:600px){
    .tabs { flex-direction: column; }
    .form-row { flex-direction: column; }
}
</style>
</head>
<body>

<h1>ü™Ç Paonde</h1>

<div class="tabs" id="tabs"></div>
<div class="container" id="diasContainer"></div>

<hr>
<h2>Agregar / Editar Opini√≥n</h2>
<div class="form-row">
  <input type="text" id="usuario" placeholder="Tu nombre">
  <select id="fecha"></select>
  <select id="zona"></select>
</div>
<div class="form-row">
  <button class="btn btn-vuelo" onclick="seleccionVuelo(true)">‚úÖ Se vuela</button>
  <button class="btn btn-no-vuelo" onclick="seleccionVuelo(false)">‚ùå No se vuela</button>
</div>
<div class="form-row" id="estrellasContainer" style="display:none;"></div>
<button onclick="agregarOpinion()">Guardar Opini√≥n</button>

<script>
const zonas = ["Faro","Sanomedio","Iroite","Oia","Cerdal","Cerdedo","Razo","Quiroga","Rodicio","Larouco"];
let datos = [];
let vueloSeleccionado = null;
let estrellasSeleccionadas = 0;
let diaActivo = 0;
let editando = null;

// --- Persistencia ---
function guardarDatos(){ localStorage.setItem('datosVuelos', JSON.stringify(datos)); }
function cargarDatos(){
    const guardado = localStorage.getItem('datosVuelos');
    if(guardado){ datos = JSON.parse(guardado); }
    else{
        for(let i=0;i<3;i++){
            let fecha = new Date();
            fecha.setDate(fecha.getDate()+i);
            let fechaStr = fecha.toISOString().slice(0,10);
            datos.push({ fecha: fechaStr, zonas: zonas.map(z=>({nombre:z, opiniones:[]})) });
        }
    }
}
cargarDatos();

// --- Selects ---
const fechaSelect = document.getElementById("fecha");
const zonaSelect = document.getElementById("zona");
fechaSelect.innerHTML=""; zonaSelect.innerHTML="";
datos.forEach(d=>{ let opt=document.createElement("option"); opt.value=d.fecha; opt.textContent=d.fecha; fechaSelect.appendChild(opt); });
zonas.forEach(z=>{ let opt=document.createElement("option"); opt.value=z; opt.textContent=z; zonaSelect.appendChild(opt); });

// --- Tabs ---
const tabsDiv = document.getElementById("tabs");
tabsDiv.innerHTML="";
datos.forEach((d,i)=>{
    let t=document.createElement("div");
    t.className="tab"+(i===0?" active":"");
    t.textContent=d.fecha;
    t.onclick=()=>{ diaActivo=i; updateTabs(); render(); };
    tabsDiv.appendChild(t);
});
function updateTabs(){ document.querySelectorAll(".tab").forEach((t,i)=>t.className="tab"+(i===diaActivo?" active":"")); }

// --- Vuelo / estrellas ---
const estrellasContainer = document.getElementById("estrellasContainer");
function seleccionVuelo(valor){
    vueloSeleccionado = valor;
    estrellasContainer.style.display = valor ? "flex" : "none";
    estrellasSeleccionadas = 0;
    dibujarEstrellas();
}
function dibujarEstrellas(){
    estrellasContainer.innerHTML="";
    for(let i=1;i<=5;i++){
        let s = document.createElement("span");
        s.textContent = "‚≠ê";
        s.dataset.val=i;
        s.className = i<=estrellasSeleccionadas?"selected":"unselected";
        s.onclick = ()=>{ estrellasSeleccionadas=i; dibujarEstrellas(); };
        estrellasContainer.appendChild(s);
    }
}

// --- Agregar / Editar ---
function agregarOpinion(){
    const usuario = document.getElementById("usuario").value.trim();
    const fecha = fechaSelect.value;
    const zona = zonaSelect.value;
    if(!usuario){ alert("Introduce tu nombre"); return; }
    if(vueloSeleccionado===null){ alert("Selecciona se vuela o no se vuela"); return; }
    if(vueloSeleccionado && estrellasSeleccionadas===0){ alert("Selecciona cu√°ntas estrellas"); return; }

    const dia = datos.find(d=>d.fecha===fecha);
    const zonaObj = dia.zonas.find(z=>z.nombre===zona);

    if(editando){ zonaObj.opiniones[editando.indice] = {usuario, vuelo:vueloSeleccionado, estrellas:estrellasSeleccionadas}; editando=null; }
    else{ zonaObj.opiniones.push({usuario, vuelo:vueloSeleccionado, estrellas:estrellasSeleccionadas}); }

    vueloSeleccionado=null; estrellasSeleccionadas=0; estrellasContainer.style.display="none";
    guardarDatos(); render();
}

// --- Agrupar opiniones ---
function agrupar(opiniones){
    let grupos=[];
    opiniones.forEach((op,i)=>{
        let g = grupos.find(g=>g.vuelo===op.vuelo && g.estrellas===op.estrellas);
        if(g){ g.usuarios.push(op.usuario); g.indices.push(i); }
        else{ grupos.push({vuelo:op.vuelo, estrellas:op.estrellas, usuarios:[op.usuario], indices:[i]}); }
    });
    return grupos;
}

// --- Editar / Borrar ---
function editarOpinion(fecha,zona,indice){
    const dia = datos.find(d=>d.fecha===fecha);
    const zonaObj = dia.zonas.find(z=>z.nombre===zona);
    const op = zonaObj.opiniones[indice];
    document.getElementById("usuario").value = op.usuario;
    fechaSelect.value = fecha;
    zonaSelect.value = zona;
    seleccionVuelo(op.vuelo);
    if(op.vuelo){ estrellasSeleccionadas=op.estrellas; dibujarEstrellas(); }
    editando={fecha,zona,indice};
}
function eliminarOpinion(fecha,zona,indice){
    const dia = datos.find(d=>d.fecha===fecha);
    const zonaObj = dia.zonas.find(z=>z.nombre===zona);
    zonaObj.opiniones.splice(indice,1);
    guardarDatos(); render();
}

// --- Renderizado ---
function render(){
    const container = document.getElementById("diasContainer");
    container.innerHTML="";
    const dia = datos[diaActivo];
    const nombreUsuario = document.getElementById("usuario").value.trim();

    dia.zonas.forEach(zona=>{
        let divZona=document.createElement("div"); divZona.className="zona";
        let h3=document.createElement("h3"); h3.textContent=`ü™Ç ${zona.nombre}`; divZona.appendChild(h3);

        let grupos=agrupar(zona.opiniones);
        grupos.forEach(g=>{
            let divOp=document.createElement("div");
            divOp.className="opinion "+(g.vuelo?"vuelo":"no-vuelo");
            divOp.appendChild(document.createTextNode(g.vuelo?"‚úÖ Se vuela":"‚ùå No se vuela")); divOp.appendChild(document.createElement("br"));

            if(g.vuelo){
                let starsSpan=document.createElement("span"); starsSpan.className="stars";
                for(let i=0;i<g.estrellas;i++){ let s=document.createElement("span"); s.textContent="‚≠ê"; s.className="selected"; starsSpan.appendChild(s); }
                divOp.appendChild(starsSpan); divOp.appendChild(document.createElement("br"));
            }

            g.usuarios.forEach((u,i)=>{
                let span=document.createElement("span"); span.textContent=u; divOp.appendChild(span);
                if(u===nombreUsuario){
                    let btnE=document.createElement("button"); btnE.className="btn btn-edit"; btnE.textContent="Editar";
                    btnE.onclick=()=>editarOpinion(dia.fecha,zona.nombre,g.indices[i]);
                    divOp.appendChild(btnE);
                    let btnD=document.createElement("button"); btnD.className="btn btn-delete"; btnD.textContent="Borrar";
                    btnD.onclick=()=>eliminarOpinion(dia.fecha,zona.nombre,g.indices[i]);
                    divOp.appendChild(btnD);
                }
                divOp.appendChild(document.createElement("br"));
            });

            divZona.appendChild(divOp);
        });

        container.appendChild(divZona);
    });
}

render();
</script>
</body>
</html>

